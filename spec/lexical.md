# 词法规范

本文档定义 Zero 语言的词法结构。

---

## 字符集

Zero 源代码使用 **UTF-8** 编码。

---

## 空白符

以下字符被视为空白符，用于分隔词法单元，在语法分析中被忽略：

- 空格 (U+0020)
- 制表符 (U+0009)
- 换行符 (U+000A)
- 回车符 (U+000D)

---

## 注释

Zero 支持单行注释：

```ebnf
Comment ::= '//' [^\n]* '\n'
```

**规则**:

- 注释从 `//` 开始，到行尾结束
- 注释在词法分析阶段被忽略

**示例**:

```zero
// 这是一个单行注释
let x = 42; // 行尾注释
```

**TODO**: 未来版本可能支持多行注释 `/* ... */`。

---

## 标识符

```ebnf
Identifier ::= IdentifierStart IdentifierContinue*
IdentifierStart ::= [a-zA-Z_]
IdentifierContinue ::= [a-zA-Z0-9_]
```

**规则**:

- 标识符必须以字母（`a-z`, `A-Z`）或下划线（`_`）开头
- 后续字符可以是字母、数字（`0-9`）或下划线
- 标识符区分大小写
- 标识符不能是关键字
- 标识符长度无限制（实现可以设置合理上限，建议至少支持 255 字符）

**合法示例**:

```zero
x
name
my_var
counter1
_temp
MyClass
```

**非法示例**:

```zero
1x          // 以数字开头
if          // 关键字
my-var      // 包含连字符
hello world // 包含空格
```

---

## 关键字

以下标识符为保留关键字，不能用作标识符：

```zero
let     var     fn      return
if      else    while   for
in      true    false
```

**说明**:

- 关键字区分大小写
- 所有关键字都是小写

---

## 字面量

### 整数字面量

```ebnf
IntegerLiteral ::= DecimalLiteral
DecimalLiteral ::= '0' | [1-9][0-9]*
```

**规则**:

- 仅支持十进制整数
- 不允许前导零（`0` 本身除外）
- 表示 64 位有符号整数
- 范围：`-9,223,372,036,854,775,808` 到 `9,223,372,036,854,775,807`

**合法示例**:

```zero
0
42
1000
999999
```

**非法示例**:

```zero
00        // 前导零
007       // 前导零
0x10      // 不支持十六进制
0b1010    // 不支持二进制
1_000     // 不支持下划线分隔
```

**TODO**: 未来版本可能支持：

- 十六进制 (`0x10`)
- 八进制 (`0o10`)
- 二进制 (`0b1010`)
- 下划线分隔符 (`1_000_000`)

---

### 浮点数字面量

```ebnf
FloatLiteral ::= DecimalLiteral '.' [0-9]+
```

**规则**:

- 必须包含小数点和至少一位小数
- 遵循 IEEE 754 双精度浮点数标准（64位）
- 不支持科学计数法（当前版本）

**合法示例**:

```zero
3.14
0.5
100.0
0.0
```

**非法示例**:

```zero
3.        // 缺少小数部分
.14       // 缺少整数部分
3         // 必须有小数点
1.5e10    // 不支持科学计数法
```

**TODO**: 未来版本可能支持：

- 科学计数法 (`1.5e10`, `2.3E-5`)
- 下划线分隔符 (`3.141_592`)

---

### 字符串字面量

```ebnf
StringLiteral ::= '"' StringCharacter* '"'
StringCharacter ::= EscapeSequence | [^"\\\n]
EscapeSequence ::= '\\' ('n' | 't' | '\\' | '"')
```

**规则**:

- 使用双引号（`"`）包围
- 字符串使用 UTF-8 编码
- 字符串不能跨行（必须在同一行内闭合）
- 支持以下转义序列：
  - `\n` - 换行符 (U+000A)
  - `\t` - 制表符 (U+0009)
  - `\\` - 反斜杠
  - `\"` - 双引号

**合法示例**:

```zero
"Hello"
"Hello, World!"
""                    // 空字符串
"Hello\nWorld"        // 带换行
"She said \"Hi\""     // 带引号
"Path: C:\\Users"     // 带反斜杠
```

**非法示例**:

```zero
"未闭合
'单引号'              // 不支持单引号
"跨行
字符串"               // 不能跨行
"无效转义\x"          // 不支持的转义序列
```

**TODO**: 未来版本可能支持：

- 更多转义序列（`\r`, `\0`, `\xNN`, `\uNNNN`）
- 多行字符串
- 原始字符串（raw string）
- 字符串插值

---

### 布尔字面量

```ebnf
BooleanLiteral ::= 'true' | 'false'
```

**规则**:

- 布尔字面量是关键字
- 表示布尔类型的两个值
- 区分大小写（必须小写）

**合法示例**:

```zero
true
false
```

**非法示例**:

```zero
True      // 大写
TRUE      // 全大写
False     // 大写
```

---

## 运算符和标点符号

Zero 语言包含以下运算符和标点符号：

### 算术运算符

```zero
+    加法
-    减法/一元负号
*    乘法
/    除法
%    取模
```

### 比较运算符

```zero
==   等于
!=   不等于
<    小于
<=   小于等于
>    大于
>=   大于等于
```

### 逻辑运算符

```zero
&&   逻辑与
||   逻辑或
!    逻辑非
```

### 其他运算符

```zero
=    赋值
..   范围（用于 for 循环）
```

### 标点符号

```zero
;    语句终止符
,    分隔符（用于函数参数）
( )  括号
{ }  代码块
```

---

## 词法分析规则

### 最长匹配原则

词法分析器使用最长匹配原则：

- `<=` 识别为单个词法单元，而不是 `<` 和 `=`
- `==` 识别为单个词法单元，而不是两个 `=`

### 空白符和注释

- 空白符用于分隔词法单元
- 注释在词法分析阶段被忽略
- 多个连续空白符视为一个

### 关键字优先级

当标识符与关键字相同时，优先识别为关键字：

```zero
let    // 关键字，不是标识符
if     // 关键字，不是标识符
```

---

## 词法错误

以下情况会导致词法错误：

1. **无效字符**: 源代码包含 UTF-8 编码之外的字符
2. **未闭合字符串**: 字符串缺少结束引号
3. **无效转义序列**: 字符串中包含不支持的转义
4. **无效数字格式**: 如前导零的整数

**示例**:

```zero
"unclosed string       // 错误：未闭合字符串
"invalid \x escape"    // 错误：无效转义序列
007                    // 错误：前导零
```

---

## 总结

Zero 的词法结构简洁明了：

- **字符集**: UTF-8
- **空白符**: 空格、制表符、换行符
- **注释**: 单行注释 `//`
- **标识符**: 字母/下划线开头，后跟字母/数字/下划线
- **关键字**: 11个保留字
- **字面量**: 整数、浮点数、字符串、布尔
- **运算符**: 算术、比较、逻辑、赋值、范围
- **标点**: 分号、逗号、括号、花括号
