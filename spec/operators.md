# 运算符

本文档定义 Zero 语言的运算符、优先级和结合性。

---

## 运算符概览

Zero 支持以下类别的运算符：

- **算术运算符**: `+`, `-`, `*`, `/`, `%`
- **比较运算符**: `==`, `!=`, `<`, `<=`, `>`, `>=`
- **逻辑运算符**: `&&`, `||`, `!`
- **赋值运算符**: `=`
- **范围运算符**: `..`

---

## 运算符优先级和结合性

从高到低排列：

| 优先级 | 运算符 | 名称 | 结合性 | 适用类型 |
|--------|--------|------|--------|----------|
| 1 | `()` | 括号/函数调用 | 左到右 | 所有 |
| 2 | `!`, `-` | 逻辑非、一元负号 | 右到左 | Boolean, Integer/Float |
| 3 | `*`, `/`, `%` | 乘、除、取模 | 左到右 | Integer/Float |
| 4 | `+`, `-` | 加、减 | 左到右 | Integer/Float |
| 5 | `..` | 范围 | 左到右 | Integer |
| 6 | `<`, `<=`, `>`, `>=` | 比较 | 左到右 | Integer/Float/String |
| 7 | `==`, `!=` | 相等性 | 左到右 | 所有 |
| 8 | `&&` | 逻辑与 | 左到右 | Boolean |
| 9 | `\|\|` | 逻辑或 | 左到右 | Boolean |
| 10 | `=` | 赋值 | 右到左 | 所有 |

---

## 算术运算符

### 加法 `+`

**语法**: `expr1 + expr2`

**适用类型**: Integer, Float

**语义**: 数值相加

**类型规则**: 两个操作数必须是相同类型

**返回类型**: 与操作数相同

**示例**:

```zero
let a = 5 + 3;        // 8 (Integer)
let b = 3.14 + 2.71;  // 5.85 (Float)
```

**溢出行为**:

- Integer 溢出当前未定义（**TODO**: 应定义为回绕、饱和或panic）
- Float 溢出产生无穷大

---

### 减法 `-`

**语法**: `expr1 - expr2`

**适用类型**: Integer, Float

**语义**: 数值相减

**类型规则**: 两个操作数必须是相同类型

**返回类型**: 与操作数相同

**示例**:

```zero
let a = 10 - 3;       // 7 (Integer)
let b = 5.5 - 2.3;    // 3.2 (Float)
```

---

### 乘法 `*`

**语法**: `expr1 * expr2`

**适用类型**: Integer, Float

**语义**: 数值相乘

**类型规则**: 两个操作数必须是相同类型

**返回类型**: 与操作数相同

**示例**:

```zero
let a = 4 * 5;        // 20 (Integer)
let b = 3.14 * 2.0;   // 6.28 (Float)
```

---

### 除法 `/`

**语法**: `expr1 / expr2`

**适用类型**: Integer, Float

**语义**: 数值相除

**类型规则**: 两个操作数必须是相同类型

**返回类型**: 与操作数相同

**整数除法**: 向零截断（truncate towards zero）

```zero
10 / 3     // 3
-10 / 3    // -3
10 / -3    // -3
-10 / -3   // 3
```

**浮点除法**: IEEE 754 浮点除法

```zero
10.0 / 3.0    // 3.333...
1.0 / 0.0     // +inf
-1.0 / 0.0    // -inf
```

**除零行为**:

- Integer: 运行时错误，程序终止
- Float: 产生 `+inf` 或 `-inf`

---

### 取模 `%`

**语法**: `expr1 % expr2`

**适用类型**: 仅 Integer

**语义**: 返回除法的余数

**符号规则**: 结果的符号与被除数相同

**返回类型**: Integer

**示例**:

```zero
10 % 3     // 1
-10 % 3    // -1
10 % -3    // 1
-10 % -3   // -1
```

**除零行为**: 运行时错误，程序终止

---

### 一元负号 `-`

**语法**: `-expr`

**适用类型**: Integer, Float

**语义**: 数值取反

**返回类型**: 与操作数相同

**示例**:

```zero
let a = -5;          // -5
let b = -(-3);       // 3
let c = -(10 + 20);  // -30
```

---

## 比较运算符

所有比较运算符返回 Boolean 类型。

### 等于 `==`

**语法**: `expr1 == expr2`

**适用类型**: 所有类型

**语义**: 测试两个值是否相等

**类型规则**: 两个操作数必须是相同类型

**返回类型**: Boolean

**比较规则**:

- Integer/Float: 数值比较
- String: 逐字节比较（UTF-8）
- Boolean: 逻辑值比较

**示例**:

```zero
5 == 5           // true
3.14 == 3.14     // true
"hello" == "hello"  // true
true == true     // true
5 == 10          // false
```

**浮点数比较注意**:

```zero
0.1 + 0.2 == 0.3  // 可能为 false（精度问题）
```

---

### 不等于 `!=`

**语法**: `expr1 != expr2`

**适用类型**: 所有类型

**语义**: 测试两个值是否不相等

**返回类型**: Boolean

**示例**:

```zero
5 != 10          // true
"a" != "b"       // true
true != false    // true
```

---

### 小于 `<`

**语法**: `expr1 < expr2`

**适用类型**: Integer, Float, String

**语义**: 测试左操作数是否小于右操作数

**返回类型**: Boolean

**比较规则**:

- 数值: 数学意义上的小于
- 字符串: 字典序比较（按 UTF-8 字节序）

**示例**:

```zero
5 < 10           // true
3.14 < 2.71      // false
"apple" < "banana"  // true
"A" < "a"        // true (ASCII 65 < 97)
```

---

### 小于等于 `<=`

**语法**: `expr1 <= expr2`

**适用类型**: Integer, Float, String

**语义**: 测试左操作数是否小于或等于右操作数

**返回类型**: Boolean

**示例**:

```zero
5 <= 10          // true
10 <= 10         // true
```

---

### 大于 `>`

**语法**: `expr1 > expr2`

**适用类型**: Integer, Float, String

**语义**: 测试左操作数是否大于右操作数

**返回类型**: Boolean

**示例**:

```zero
10 > 5           // true
3.14 > 2.71      // true
```

---

### 大于等于 `>=`

**语法**: `expr1 >= expr2`

**适用类型**: Integer, Float, String

**语义**: 测试左操作数是否大于或等于右操作数

**返回类型**: Boolean

**示例**:

```zero
10 >= 5          // true
10 >= 10         // true
```

---

## 逻辑运算符

### 逻辑与 `&&`

**语法**: `expr1 && expr2`

**适用类型**: Boolean

**语义**: 逻辑与运算

**返回类型**: Boolean

**真值表**:

| expr1 | expr2 | 结果 |
|-------|-------|------|
| true  | true  | true |
| true  | false | false |
| false | true  | false |
| false | false | false |

**短路求值**:

- 如果 `expr1` 为 `false`，则不求值 `expr2`
- 仅当 `expr1` 为 `true` 时才求值 `expr2`

**示例**:

```zero
true && true      // true
true && false     // false
false && true     // false

// 短路求值
let x = false && expensive_function();  // expensive_function() 不会被调用
```

---

### 逻辑或 `||`

**语法**: `expr1 || expr2`

**适用类型**: Boolean

**语义**: 逻辑或运算

**返回类型**: Boolean

**真值表**:

| expr1 | expr2 | 结果 |
|-------|-------|------|
| true  | true  | true |
| true  | false | true |
| false | true  | true |
| false | false | false |

**短路求值**:

- 如果 `expr1` 为 `true`，则不求值 `expr2`
- 仅当 `expr1` 为 `false` 时才求值 `expr2`

**示例**:

```zero
true || false     // true
false || true     // true
false || false    // false

// 短路求值
let x = true || expensive_function();  // expensive_function() 不会被调用
```

---

### 逻辑非 `!`

**语法**: `!expr`

**适用类型**: Boolean

**语义**: 逻辑非运算（取反）

**返回类型**: Boolean

**真值表**:

| expr  | 结果 |
|-------|------|
| true  | false |
| false | true |

**示例**:

```zero
!true       // false
!false      // true
!(5 > 10)   // true
```

---

## 赋值运算符

### 赋值 `=`

**语法**: `identifier = expr`

**语义**: 将表达式的值赋给变量

**适用于**: `var` 声明的可变变量

**类型规则**: 表达式类型必须与变量类型匹配

**返回值**: 赋值表达式返回被赋的值

**结合性**: 右结合

**示例**:

```zero
var x = 10;
x = 20;          // 正确
x = x + 5;       // 正确

let y = 10;
// y = 20;       // 错误：y 是不可变的

var a = 1;
var b = 2;
a = b = 3;       // 链式赋值，a 和 b 都是 3
```

**限制**:

- 不能对 `let` 声明的变量赋值
- 不能改变变量类型

---

## 范围运算符

### 范围 `..`

**语法**: `start..end`

**适用类型**: Integer

**语义**: 创建半开区间 `[start, end)`

**返回类型**: Range（仅用于 for 循环）

**包含规则**:

- 包含 `start`
- 不包含 `end`
- 空范围: 当 `start >= end` 时

**示例**:

```zero
for i in 0..5 {
    print(i);    // 输出: 0, 1, 2, 3, 4
}

for i in 5..5 {
    // 循环体不执行（空范围）
}

for i in 10..5 {
    // 循环体不执行（空范围）
}
```

**限制**:

- 只能在 `for` 循环中使用
- 不能赋值给变量
- 不支持浮点数范围

**TODO**: 未来版本可能支持：

- 闭区间 `start..=end`
- 步长 `start..end:step`
- 浮点数范围

---

## 运算符优先级示例

```zero
// 优先级示例
1 + 2 * 3        // 7，不是 9（* 优先级高于 +）
10 - 5 - 2       // 3，左结合（(10 - 5) - 2）
2 + 3 < 5 * 2    // true（2 + 3 < 10）
true || false && false  // true（&& 优先级高于 ||）

// 使用括号改变优先级
(1 + 2) * 3      // 9
(10 - 5) - 2     // 3
```

---

## 运算符结合性

### 左结合

大多数二元运算符是左结合的：

```zero
a + b + c     // (a + b) + c
a - b - c     // (a - b) - c
a * b * c     // (a * b) * c
```

### 右结合

一元运算符和赋值运算符是右结合的：

```zero
a = b = c     // a = (b = c)
!!x           // !(!x)
--x           // -(-x)
```

---

## 类型检查规则

### 严格类型匹配

运算符要求操作数类型匹配：

```zero
// 正确
let a = 10 + 20;        // Integer + Integer
let b = 3.14 + 2.71;    // Float + Float

// 错误
let c = 10 + 3.14;      // Integer + Float（类型不匹配）
let d = 10 && 20;       // Integer（需要 Boolean）
let e = "hello" + "world";  // String（不支持 + 运算符）
```

### 运算符重载

当前版本不支持运算符重载。每个运算符只对特定类型有效。

**TODO**: 未来版本可能支持用户自定义类型的运算符重载。

---

## TODO 列表

未来版本计划的运算符增强：

- [ ] 复合赋值运算符（`+=`, `-=`, `*=`, `/=`, `%=`）
- [ ] 位运算符（`&`, `|`, `^`, `~`, `<<`, `>>`）
- [ ] 字符串连接运算符（`+`）
- [ ] 条件运算符（三元运算符 `? :`）
- [ ] 空值合并运算符（`??`）
- [ ] 管道运算符（`|>`）
- [ ] 运算符重载
